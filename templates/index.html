<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ðŸ“– Realistic Diary App</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.14.1/gsap.min.js"></script>
<style>
body {
  background: #f0e8de;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  margin: 0;
  padding: 0;
  overflow-x: hidden;
}

/* Notebook container */
.notebook {
  perspective: 2000px;
  width: 90%;
  max-width: 900px;
  margin: 50px auto;
  position: relative;
}

/* Notebook cover & pages */
.cover, .page {
  width: 100%;
  height: 500px;
  border-radius: 12px;
  position: absolute;
  top: 0;
  left: 0;
  backface-visibility: hidden;
  transform-origin: left center;
  overflow: hidden;
}

/* Cover */
.cover {
  background: linear-gradient(to bottom, #8b4513, #5a2e0b);
  color: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2.5rem;
  font-weight: bold;
  cursor: pointer;
  box-shadow: 0 15px 35px rgba(0,0,0,0.4);
}

/* Pages */
.page {
  background: #fff9e6;
  padding: 20px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.25);
  overflow-y: auto;
  border-left: 4px solid #d9b36c;
  transform: rotateY(-180deg);
  cursor: pointer;
}

.page h2 { font-size: 1.5rem; margin-bottom: 5px; }
.page-number {
  text-align: right;
  font-size: 0.8rem;
  color: #888;
  margin-top: auto;
}

/* Sticky notes */
.sticky-note {
  background: #fff9b0;
  padding: 12px;
  border-radius: 8px;
  box-shadow: 2px 2px 10px rgba(0,0,0,0.2);
  cursor: grab;
  transition: transform 0.2s;
  position: relative;
}
.sticky-note:hover { transform: scale(1.03) rotateZ(1deg); }

/* Add Note Button */
.add-note-btn {
  background: #34d399;
  color: white;
  font-weight: bold;
  padding: 8px 14px;
  border-radius: 8px;
  margin-top: 10px;
  align-self: center;
  cursor: pointer;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  transition: all 0.2s;
}
.add-note-btn:hover { background: #059669; transform: scale(1.05); }

@media (max-width: 768px) {
  .notebook { margin: 20px auto; }
  .cover, .page { height: 400px; }
}
</style>
</head>
<body>

<div class="notebook relative">
  <div class="cover">ðŸ“– My Diary</div>
  <div id="pagesContainer"></div>
</div>

<script>
const cover = document.querySelector('.cover');
const pagesContainer = document.getElementById('pagesContainer');
let notesData = [];
let currentIndex = 0;

// Open notebook
cover.addEventListener('click', () => {
  gsap.to(cover, { rotateY: -160, duration: 1.2, ease: "power2.inOut", onComplete: () => {
    cover.style.display = "none";
    loadNotes();
  }});
});

// Fetch notes
async function loadNotes() {
  const res = await fetch("/api/notes");
  notesData = await res.json();
  renderPages();
}

// Render pages
function renderPages() {
  pagesContainer.innerHTML = '';

  if(notesData.length === 0){
    const emptyPage = document.createElement('div');
    emptyPage.className = 'page';
    emptyPage.innerHTML = `<div style="text-align:center;margin-top:45%;">Click "Add Note" to start your diary!</div>`;
    pagesContainer.appendChild(emptyPage);
    gsap.fromTo(emptyPage, {rotateY:-180}, {rotateY:0, duration:1});
  } else {
    notesData.forEach((note, index) => {
      const page = document.createElement('div');
      page.className = 'page';
      page.style.zIndex = notesData.length - index;
      page.innerHTML = `
        <div class="sticky-note" draggable="true">
          <h2>${note.title}</h2>
          <p>${note.body}</p>
          <button onclick="editNote('${note.id}')" class="text-blue-600 hover:underline absolute top-2 right-14">Edit</button>
          <button onclick="deleteNote('${note.id}')" class="text-red-600 hover:underline absolute top-2 right-2">X</button>
        </div>
        <div class="page-number">Page ${index + 1}</div>
      `;
      pagesContainer.appendChild(page);

      // Initial flip animation
      gsap.fromTo(page, {rotateY:-180}, {rotateY:0, duration:1, delay:0.2*index});

      // Page click for realistic flip
      page.addEventListener('click', () => {
        if(currentIndex === index){
          gsap.to(page, {rotateY:-180, duration:0.6, ease:"power2.inOut"});
          currentIndex++;
        }
      });
    });
  }

  // Add Note button
  const addBtn = document.createElement('div');
  addBtn.className = 'add-note-btn';
  addBtn.textContent = 'âž• Add Note';
  addBtn.onclick = saveNote;
  pagesContainer.appendChild(addBtn);
}

// Save note
async function saveNote() {
  const title = prompt("Enter note title:");
  const body = prompt("Write your note:");
  if(!title || !body) return alert("Both title and body are required");

  const note = { id: Date.now().toString(), title, body };
  await fetch("/api/notes", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(note)
  });
  await loadNotes();
}

// Edit note
async function editNote(id) {
  const res = await fetch(`/api/notes/${id}`);
  if(!res.ok) return alert("Note not found");
  const note = await res.json();
  const newTitle = prompt("Edit title:", note.title);
  const newBody = prompt("Edit body:", note.body);
  if(!newTitle || !newBody) return;
  await fetch(`/api/notes/${id}`, {
    method: "PUT",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ id, title: newTitle, body: newBody })
  });
  await loadNotes();
}

// Delete note
async function deleteNote(id) {
  if(!confirm("Delete this note?")) return;
  await fetch(`/api/notes/${id}`, { method: "DELETE" });
  await loadNotes();
}
</script>
</body>
</html>
