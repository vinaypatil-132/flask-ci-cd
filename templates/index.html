<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ðŸ“’ Realistic Notebook App</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.14.1/gsap.min.js"></script>
<style>
body {
  background: #f3f1ee;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}
.notebook {
  perspective: 2000px;
  width: 90%;
  max-width: 800px;
  margin: 50px auto;
  position: relative;
  height: 500px;
}
.cover, .page {
  width: 100%;
  height: 100%;
  border-radius: 12px;
  position: absolute;
  top: 0;
  left: 0;
  backface-visibility: hidden;
  transform-origin: left center;
  overflow: hidden;
}
.cover {
  background: linear-gradient(to bottom, #7b3f00, #4e2600);
  color: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2rem;
  font-weight: bold;
  cursor: pointer;
  box-shadow: 0 15px 35px rgba(0,0,0,0.4);
}
.page {
  background: #fffbe6;
  padding: 20px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.15);
  overflow-y: auto;
  border-left: 4px solid #d9b36c;
  transform: rotateY(-180deg);
}
.page h2 { font-size: 1.5rem; margin-bottom: 5px; }
textarea { width: 100%; border: none; outline: none; background: transparent; resize: none; font-size: 1rem; }
.page-number {
  text-align: right;
  font-size: 0.8rem;
  color: #888;
  margin-top: auto;
}
.sticky-note {
  background: #fff9b0;
  padding: 10px;
  border-radius: 6px;
  box-shadow: 2px 2px 8px rgba(0,0,0,0.2);
  margin-bottom: 10px;
  position: relative;
  cursor: grab;
  transition: transform 0.2s;
}
.sticky-note:hover { transform: scale(1.02) rotateZ(1deg); }
@media (max-width: 768px) {
  .notebook { margin: 20px auto; height: 400px; }
  .cover, .page { height: 100%; }
}
</style>
</head>
<body>

<div class="notebook relative">
  <!-- Closed Notebook Cover -->
  <div class="cover" id="book-cover">ðŸ“’ My Notebook (Click to Open)</div>

  <!-- Notebook Pages -->
  <div id="pagesContainer"></div>
</div>

<script>
const cover = document.getElementById('book-cover');
const pagesContainer = document.getElementById('pagesContainer');
let pages = [];
let currentPageIndex = 0;

// Open notebook animation
cover.addEventListener('click', () => {
  gsap.to(cover, {
    rotateY: -160,
    duration: 1.2,
    ease: "power2.inOut",
    onComplete: () => {
      cover.style.display = "none";
      loadPages();
    }
  });
});

// Load notes and create pages
async function loadPages() {
  const res = await fetch("/api/notes");
  const notes = await res.json();
  pagesContainer.innerHTML = '';
  pages = [];

  notes.forEach((note, index) => {
    const page = document.createElement('div');
    page.className = 'page';
    page.style.zIndex = notes.length - index;
    page.innerHTML = `
      <div class="sticky-note" draggable="true">
        <h2>${note.title}</h2>
        <p>${note.body}</p>
        <button onclick="editNote('${note.id}')" class="text-blue-600 hover:underline absolute top-2 right-10">Edit</button>
        <button onclick="deleteNote('${note.id}')" class="text-red-600 hover:underline absolute top-2 right-2">X</button>
      </div>
      <div class="page-number">Page ${index + 1}</div>
    `;
    pagesContainer.appendChild(page);
    pages.push(page);

    // Animate page flip
    gsap.fromTo(page, { rotateY: -180 }, { rotateY: 0, duration: 1, delay: 0.2 * index });
  });
}

// Save note
async function saveNote() {
  const title = prompt("Enter note title:");
  const body = prompt("Write your note:");
  if (!title || !body) return alert("Please enter both title and body");

  const note = { id: Date.now().toString(), title, body };
  await fetch("/api/notes", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(note)
  });
  loadPages();
}

// Edit note
async function editNote(id) {
  const res = await fetch(`/api/notes/${id}`);
  if (!res.ok) return alert("Note not found");
  const note = await res.json();
  const newTitle = prompt("Edit title:", note.title);
  const newBody = prompt("Edit body:", note.body);
  if (!newTitle || !newBody) return;
  await fetch(`/api/notes/${id}`, {
    method: "PUT",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ id, title: newTitle, body: newBody })
  });
  loadPages();
}

// Delete note
async function deleteNote(id) {
  if(!confirm("Delete this note?")) return;
  await fetch(`/api/notes/${id}`, { method: "DELETE" });
  loadPages();
}
</script>

</body>
</html>
